
Hydrogen Source Code
--------------------

Hydrogen is organised into 2 libraries and an executable, each of which has their own subfolder:

Library         | Source Folder | Description
--------------- | ------------- | -----------
`libhydrogen.a` | `core/`       | The bytecode parser, interpreter, and JIT compiler
`libhylib.a`    | `lib/`        | The standard library, implemented using functions exported by the core
`cli`           | `cli/`        | The command line interface for executing files and running the REPL

All include files are in `/include`. The `hydrogen.h` file is for the core, and `hylib.h` can be included to add the standard library to an instance of the interpreter.

Files in `common/` can be included by the core, standard library, and command line interface.


## Core Structure

Before we see an overview of the core components of Hydrogen, there's some terminology you'll probably want to be familiar with:

Word          | Description
------------- | -----------
Bytecode      | A sequence of low level instructions similar to assembly code
Trace         | A sequence of bytecode instructions recorded during runtime that will eventually be turned into assembly code
JIT compiling | Just in time compiling - taking a trace and converting it into assembly code
IR            | Intermediate representation - it can be thought of as low level bytecode that can be more easily optimised
SSA IR        | Single static assignment form intermediate representation - a particular type of IR that Hydrogen uses to make optimising much easier
Hot loop      | A loop that's been executed a lot which we want to JIT compile


The core contains several important parts:

Part              | Description
----------------- | -----------
Lexer             | Takes source code and outputs a sequence of lexical tokens on the fly
Bytecode Parser   | Parses syntax structures from a sequence of lexical tokens, generating bytecode on the fly
Runtime           | Takes generated bytecode and executes it. Also responsible for determining when to start a trace, and executing JIT compiled assembly
IR Compiler       | Generates SSA IR on the fly from a trace
IR Optimiser      | Takes the generated SSA IR and optimises it
Assembly Compiler | Compiles optimises SSA IR into assembly instructions


The general procedure for executing some code is:

1. Convert the source code into a sequence of lexical tokens
2. Parse the sequence of tokens into recognisable syntactic structures
3. Parse these structures into bytecode
4. Start executing the bytecode
5. Keep a look out for loops that are executed a lot
6. Start a trace when we identify a hot loop
7. Parse the trace into SSA IR
8. Optimise the IR
9. Compile the IR into assembly instructions
10. Execute the assembly code
11. Fall back to executing bytecode when the assembly has finished


A description of the most important source code files:

File         | Description
------------ | -----------
`lexer.c`    | Code for the lexer
`parser.c`   | Code for the bytecode parser
`bytecode.h` | All possible bytecode opcodes
`vm.c`       | Code for the bytecode runtime
`value.c`    | Code for manipulating runtime values
